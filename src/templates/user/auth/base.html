<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="{% block viewport %}width=device-width, initial-scale=1.0{% endblock %}" />
    <meta name="robots" content="NOARCHIVE,NOCACHE" />
    <link
      rel="shortcut icon"
      href="{{ url_for('static', filename='img/logo.svg') }}"
      type="image/x-icon"
    />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@splidejs/splide@2.4.21/dist/css/splide.min.css">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />

    <title>{% block title %}{% endblock title %}</title>

    {% block extrahead %}{% endblock extrahead %}

    <link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}" >
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}" >
    {% block extrastyles %}{% endblock extrastyles %}

    <script type="module" src="{{ url_for('static', filename='js/components.js') }}" ></script>
    {% block extrascripts %}{% endblock extrascripts %}
  </head>
  <body class="{{ theme }}" data-csrf="{{ csrf_token() }}">
    {% block body %}
    {% endblock body %}
    {% block footer %}
    <footer class="footer bg-footer">
      <div class="container container-footer text-center">
        {{ _('Copyright &copy; ITA - Computer School') }}
      </div>
    </footer>
    {% endblock footer %}
    {% block onloadscripts %}{% endblock onloadscripts %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
    <script type="text/javascript" charset="utf-8">

const chat = document.querySelector("#chat-body");

const add_msg = (msg, pos) => {
  const msghtml = `
   <div class="chat ${pos} ">
    <div class="cont-chat">
        <p>${msg.content}</p>
        <div class="cont-chat-description">
            <p>${msg.time}</p>
        </div>
    </div>
</div>`;
  chat.innerHTML = chat.innerHTML + msghtml;
};

socket?.on("message", (data)=> {
  add_msg(data)
})

const btn = document.querySelector("[data-chat]");
const inp = document.querySelector("#chat-input");
btn?.addEventListener("click", (e)=>{
  socket?.emit("message", JSON.stringify({message: inp.value}))
});
    </script>
  </body>
</html>
